<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">


    <changeSet id="#2751_migration_1" author="AndriusKarpavicius">
        <createTable tableName="tmp_cfi_copy">
            <column name="id" type="bigint" />
            <column name="code" type="varchar(255)" />
            <column name="date_value" type="datetime" />
            <column name="double_value" type="float8" />
            <column name="long_value" type="bigint" />
            <column name="string_value" type="text" />
            <column name="serialized_value" type="${type.longtext}" />
            <column name="applies_to_uuid" type="varchar(60)" />
            <column name="priority" type="int4" defaultValue="0" />
            <column name="period_end_date" type="datetime" />
            <column name="period_start_date" type="datetime" />
        </createTable>

        <sql>insert into tmp_cfi_copy (id,code,date_value,double_value,long_value,string_value,serialized_value,applies_to_uuid,priority,period_end_date,period_start_date) (select
            id,code,date_value,double_value,long_value,string_value,serialized_value,applies_to_uuid,priority,period_end_date,period_start_date from crm_custom_field_inst)
        </sql>

        <createTable tableName="tmp_cf_values">
            <column name="uuid" type="varchar(60)" />
            <column name="cf_values_txt" type="text" />
        </createTable>
    </changeSet>

    <changeSet id="#2751_migration_P1" author="AndriusKarpavicius" dbms="postgresql">

        <sql>update tmp_cfi_copy set string_value = regexp_replace(replace(string_value, '"', '\"'),'\n','\\r\\n','g')  where string_value is not null</sql>

        <sql>update tmp_cfi_copy set serialized_value = new_value from (select id, 'list_Date|['|| string_agg(new_date,',')||']' as new_value from (select id, old_date, substr(old_date,1,5) || substring(old_date,9,3)||
            substring(old_date,6,3) || substring(old_date,12) as new_date from (select id, unnest(string_to_array(substring(left(serialized_value,length(serialized_value)-1), strpos(serialized_value,'|')+2),',')) as
            old_date from crm_custom_field_inst where left(serialized_value,9)='list_Date') old_dates_array) new_dates_array group by id) new_values where tmp_cfi_copy.id=new_values.id
        </sql>

        <sql>update tmp_cfi_copy set serialized_value = new_value from (select id, string_agg(new_date,',') as new_value from (
            select id, old_date, key||substr(old_date,1,5) || substring(old_date,9,3)||
            substring(old_date,6,3) || substring(old_date,12) as new_date from (
            select id, substr(old_date_w_key,1, strpos(old_date_w_key,'":"')+1) as key, substr(old_date_w_key,strpos(old_date_w_key,'":"')+2) as
            old_date from (
            select id, unnest(string_to_array(serialized_value,',')) as old_date_w_key from crm_custom_field_inst where left(serialized_value,8)='map_Date') old_dates_array
            ) old_dates_split_key
            )
            new_dates_array group by id) new_values where tmp_cfi_copy.id=new_values.id
        </sql>

        <sql>update tmp_cfi_copy set serialized_value = new_value from (select id, string_agg(new_date,',') as new_value from (
            select id, old_date, key||substr(old_date,1,5) || substring(old_date,9,3)||
            substring(old_date,6,3) || substring(old_date,12) as new_date from (
            select id, substr(old_date_w_key,1, strpos(old_date_w_key,'":"')+1) as key, substr(old_date_w_key,strpos(old_date_w_key,'":"')+2) as
            old_date from (
            select id, unnest(string_to_array(serialized_value,',')) as old_date_w_key from crm_custom_field_inst where left(serialized_value,11)='matrix_Date'
            ) old_dates_array
            ) old_dates_split_key
            )
            new_dates_array group by id) new_values where tmp_cfi_copy.id=new_values.id
        </sql>

        <sql>delete from tmp_cf_values</sql>
        <sql>insert into tmp_cf_values (uuid, cf_values_txt) (select applies_to_uuid, cf_value_by_uuid from (select applies_to_uuid, '{'||STRING_AGG('"'||code||'":['|| cf_value_by_code ||']',',')||'}' as cf_value_by_uuid
            from (select applies_to_uuid, code, STRING_AGG(cf_opening || cf_content ||'}',',') as cf_value_by_code from (select applies_to_uuid, code, '{"priority":'||priority|| case when period_start_date is null then
            '' else ',"from":"'||to_char(period_start_date,'YYYY-MM-DD')||'T'||to_char(period_start_date,'HH24:MI:SSTZ') ||'"' end ||case when period_end_date is null then '' else
            ',"to":"'||to_char(period_end_date,'YYYY-MM-DD')||'T'||to_char(period_end_date,'HH24:MI:SSTZ') ||'"' end as cf_opening, case when double_value is not null then ',"double":'||double_value else case when
            date_value is not null then ',"date":"'||to_char(date_value,'YYYY-MM-DD')||'T'||to_char(date_value,'HH24:MI:SSTZ')||'"' else case when long_value is not null then ',"long":'||long_value else case when
            string_value is not null then ',"string":"'||string_value||'"' else case when left(serialized_value,6) != 'matrix' then replace(replace(replace(replace(replace(replace(
            replace(replace(replace(replace(replace(serialized_value,'list_String|',',"listString":'),'list_Double|',',"listDouble":'),'list_Long|',',"listLong":'),'list_Date|',',"listDate":'),'list_EntityReferenceWrapper|',',"listEntity":')
            ,'map_String|',',"mapString":'),'map_Double|',',"mapDouble":'),'map_Long|',',"mapLong":'),'map_Date|',',"mapDate":'),'map_EntityReferenceWrapper|',',"mapEntity":'),'entity|',',"entity":') else case
            left(serialized_value,strpos(serialized_value, '|')-1) when 'matrix_String' then ',"mapString":' when 'matrix_Long' then ',"mapLong":' when 'matrix_Double' then ',"mapDouble":' when 'matrix_Date' then
            ',"mapDate":' when 'matrix_EntityReferenceWrapper' then ',"mapEntity":' end || substr(substr(serialized_value, strpos(serialized_value, '|')+1), strpos(substr(serialized_value, strpos(serialized_value,
            '|')+1), '|')+1) end end end end end as cf_content from tmp_cfi_copy) cf_data group by applies_to_uuid, code) cf_values_by_code group by cf_values_by_code.applies_to_uuid) cf_values_by_uuid)
        </sql>

		<!-- NOTE: here need to change appropriate timezones for the server. This is for argentina -->
        <sql>update tmp_cf_values set cf_values_txt = replace(cf_values_txt,' 00:00:00 ART','T00:00:00-03:00')</sql>
        <sql>update tmp_cf_values set cf_values_txt = replace(cf_values_txt,'T00:00:00"','T00:00:00-03:00"')</sql>

        <sql>update crm_seller set cf_values = null</sql>
        <sql>update crm_seller set cf_values = cf_values_txt from tmp_cf_values where crm_seller.uuid = tmp_cf_values.uuid</sql>
        <sql>update crm_provider set cf_values = null</sql>
        <sql>update crm_provider set cf_values = cf_values_txt from tmp_cf_values where crm_provider.uuid = tmp_cf_values.uuid</sql>
        <sql>update account_entity set cf_values = null</sql>
        <sql>update account_entity set cf_values = cf_values_txt from tmp_cf_values where account_entity.uuid = tmp_cf_values.uuid</sql>
        <sql>update adm_user set cf_values = null</sql>
        <sql>update adm_user set cf_values = cf_values_txt from tmp_cf_values where adm_user.uuid = tmp_cf_values.uuid</sql>
        <sql>update ar_account_operation set cf_values = null</sql>
        <sql>update ar_account_operation set cf_values = cf_values_txt from tmp_cf_values where ar_account_operation.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_cycle set cf_values = null</sql>
        <sql>update billing_cycle set cf_values = cf_values_txt from tmp_cf_values where billing_cycle.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_invoice set cf_values = null</sql>
        <sql>update billing_invoice set cf_values = cf_values_txt from tmp_cf_values where billing_invoice.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_invoice_cat set cf_values = null</sql>
        <sql>update billing_invoice_cat set cf_values = cf_values_txt from tmp_cf_values where billing_invoice_cat.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_invoice_sub_cat set cf_values = null</sql>
        <sql>update billing_invoice_sub_cat set cf_values = cf_values_txt from tmp_cf_values where billing_invoice_sub_cat.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_service_instance set cf_values = null</sql>
        <sql>update billing_service_instance set cf_values = cf_values_txt from tmp_cf_values where billing_service_instance.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_subscription set cf_values = null</sql>
        <sql>update billing_subscription set cf_values = cf_values_txt from tmp_cf_values where billing_subscription.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_tax set cf_values = null</sql>
        <sql>update billing_tax set cf_values = cf_values_txt from tmp_cf_values where billing_tax.uuid = tmp_cf_values.uuid</sql>
        <sql>update cat_charge_template set cf_values = null</sql>
        <sql>update cat_charge_template set cf_values = cf_values_txt from tmp_cf_values where cat_charge_template.uuid = tmp_cf_values.uuid</sql>
        <sql>update cat_offer_template set cf_values = null</sql>
        <sql>update cat_offer_template set cf_values = cf_values_txt from tmp_cf_values where cat_offer_template.uuid = tmp_cf_values.uuid</sql>
        <sql>update cat_price_plan_matrix set cf_values = null</sql>
        <sql>update cat_price_plan_matrix set cf_values = cf_values_txt from tmp_cf_values where cat_price_plan_matrix.uuid = tmp_cf_values.uuid</sql>
        <sql>update cat_service_template set cf_values = null</sql>
        <sql>update cat_service_template set cf_values = cf_values_txt from tmp_cf_values where cat_service_template.uuid = tmp_cf_values.uuid</sql>
        <sql>update medina_access set cf_values = null</sql>
        <sql>update medina_access set cf_values = cf_values_txt from tmp_cf_values where medina_access.uuid = tmp_cf_values.uuid</sql>
        <sql>update meveo_job_instance set cf_values = null</sql>
        <sql>update meveo_job_instance set cf_values = cf_values_txt from tmp_cf_values where meveo_job_instance.uuid = tmp_cf_values.uuid</sql>
        <sql>update meveo_filter set cf_values = null</sql>
        <sql>update meveo_filter set cf_values = cf_values_txt from tmp_cf_values where meveo_filter.uuid = tmp_cf_values.uuid</sql>
        <sql>update cust_cei set cf_values = null</sql>
        <sql>update cust_cei set cf_values = cf_values_txt from tmp_cf_values where cust_cei.uuid = tmp_cf_values.uuid</sql>
        <sql>update cat_offer_template_category set cf_values = null</sql>
        <sql>update cat_offer_template_category set cf_values = cf_values_txt from tmp_cf_values where cat_offer_template_category.uuid = tmp_cf_values.uuid</sql>
        <sql>update billing_product_instance set cf_values = null</sql>
        <sql>update billing_product_instance set cf_values = cf_values_txt from tmp_cf_values where billing_product_instance.uuid = tmp_cf_values.uuid</sql>
        <sql>update ord_order set cf_values = null</sql>
        <sql>update ord_order set cf_values = cf_values_txt from tmp_cf_values where ord_order.uuid = tmp_cf_values.uuid</sql>
        <sql>update ord_quote set cf_values = null</sql>
        <sql>update ord_quote set cf_values = cf_values_txt from tmp_cf_values where ord_quote.uuid = tmp_cf_values.uuid</sql>
    </changeSet>

    <changeSet id="#2751_migration_M1" author="AndriusKarpavicius" dbms="mysql">
    
    
        <sql>update tmp_cfi_copy set string_value = replace(string_value, '"', '\"') where string_value is not null</sql>

        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-01','-AKKR01-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-02','-AKKR02-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-03','-AKKR03-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-04','-AKKR04-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-05','-AKKR05-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-06','-AKKR06-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-07','-AKKR07-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-08','-AKKR08-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-09','-AKKR09-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-10','-AKKR10-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-11','-AKKR11-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-01-12','-AKKR12-01') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-01','-AKKR01-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-02','-AKKR02-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-03','-AKKR03-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-04','-AKKR04-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-05','-AKKR05-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-06','-AKKR06-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-07','-AKKR07-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-08','-AKKR08-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-09','-AKKR09-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-10','-AKKR10-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-11','-AKKR11-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-02-12','-AKKR12-02') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-01','-AKKR01-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-02','-AKKR02-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-03','-AKKR03-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-04','-AKKR04-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-05','-AKKR05-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-06','-AKKR06-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-07','-AKKR07-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-08','-AKKR08-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-09','-AKKR09-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-10','-AKKR10-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-11','-AKKR11-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-03-12','-AKKR12-03') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-01','-AKKR01-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-02','-AKKR02-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-03','-AKKR03-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-04','-AKKR04-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-05','-AKKR05-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-06','-AKKR06-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-07','-AKKR07-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-08','-AKKR08-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-09','-AKKR09-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-10','-AKKR10-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-11','-AKKR11-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-04-12','-AKKR12-04') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-01','-AKKR01-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-02','-AKKR02-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-03','-AKKR03-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-04','-AKKR04-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-05','-AKKR05-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-06','-AKKR06-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-07','-AKKR07-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-08','-AKKR08-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-09','-AKKR09-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-10','-AKKR10-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-11','-AKKR11-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-05-12','-AKKR12-05') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-01','-AKKR01-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-02','-AKKR02-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-03','-AKKR03-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-04','-AKKR04-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-05','-AKKR05-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-06','-AKKR06-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-07','-AKKR07-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-08','-AKKR08-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-09','-AKKR09-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-10','-AKKR10-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-11','-AKKR11-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-06-12','-AKKR12-06') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-01','-AKKR01-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-02','-AKKR02-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-03','-AKKR03-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-04','-AKKR04-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-05','-AKKR05-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-06','-AKKR06-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-07','-AKKR07-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-08','-AKKR08-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-09','-AKKR09-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-10','-AKKR10-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-11','-AKKR11-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-07-12','-AKKR12-07') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-01','-AKKR01-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-02','-AKKR02-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-03','-AKKR03-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-04','-AKKR04-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-05','-AKKR05-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-06','-AKKR06-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-07','-AKKR07-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-08','-AKKR08-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-09','-AKKR09-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-10','-AKKR10-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-11','-AKKR11-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-08-12','-AKKR12-08') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-01','-AKKR01-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-02','-AKKR02-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-03','-AKKR03-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-04','-AKKR04-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-05','-AKKR05-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-06','-AKKR06-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-07','-AKKR07-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-08','-AKKR08-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-09','-AKKR09-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-10','-AKKR10-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-11','-AKKR11-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-09-12','-AKKR12-09') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-01','-AKKR01-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-02','-AKKR02-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-03','-AKKR03-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-04','-AKKR04-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-05','-AKKR05-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-06','-AKKR06-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-07','-AKKR07-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-08','-AKKR08-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-09','-AKKR09-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-10','-AKKR10-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-11','-AKKR11-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-10-12','-AKKR12-10') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-01','-AKKR01-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-02','-AKKR02-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-03','-AKKR03-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-04','-AKKR04-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-05','-AKKR05-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-06','-AKKR06-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-07','-AKKR07-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-08','-AKKR08-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-09','-AKKR09-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-10','-AKKR10-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-11','-AKKR11-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-11-12','-AKKR12-11') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-01','-AKKR01-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-02','-AKKR02-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-03','-AKKR03-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-04','-AKKR04-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-05','-AKKR05-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-06','-AKKR06-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-07','-AKKR07-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-08','-AKKR08-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-09','-AKKR09-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-10','-AKKR10-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-11','-AKKR11-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-12-12','-AKKR12-12') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-01','-AKKR01-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-02','-AKKR02-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-03','-AKKR03-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-04','-AKKR04-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-05','-AKKR05-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-06','-AKKR06-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-07','-AKKR07-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-08','-AKKR08-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-09','-AKKR09-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-10','-AKKR10-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-11','-AKKR11-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-13-12','-AKKR12-13') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-01','-AKKR01-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-02','-AKKR02-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-03','-AKKR03-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-04','-AKKR04-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-05','-AKKR05-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-06','-AKKR06-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-07','-AKKR07-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-08','-AKKR08-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-09','-AKKR09-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-10','-AKKR10-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-11','-AKKR11-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-14-12','-AKKR12-14') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-01','-AKKR01-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-02','-AKKR02-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-03','-AKKR03-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-04','-AKKR04-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-05','-AKKR05-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-06','-AKKR06-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-07','-AKKR07-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-08','-AKKR08-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-09','-AKKR09-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-10','-AKKR10-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-11','-AKKR11-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-15-12','-AKKR12-15') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-01','-AKKR01-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-02','-AKKR02-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-03','-AKKR03-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-04','-AKKR04-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-05','-AKKR05-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-06','-AKKR06-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-07','-AKKR07-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-08','-AKKR08-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-09','-AKKR09-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-10','-AKKR10-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-11','-AKKR11-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-16-12','-AKKR12-16') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-01','-AKKR01-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-02','-AKKR02-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-03','-AKKR03-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-04','-AKKR04-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-05','-AKKR05-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-06','-AKKR06-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-07','-AKKR07-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-08','-AKKR08-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-09','-AKKR09-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-10','-AKKR10-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-11','-AKKR11-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-17-12','-AKKR12-17') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-01','-AKKR01-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-02','-AKKR02-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-03','-AKKR03-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-04','-AKKR04-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-05','-AKKR05-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-06','-AKKR06-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-07','-AKKR07-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-08','-AKKR08-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-09','-AKKR09-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-10','-AKKR10-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-11','-AKKR11-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-18-12','-AKKR12-18') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-01','-AKKR01-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-02','-AKKR02-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-03','-AKKR03-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-04','-AKKR04-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-05','-AKKR05-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-06','-AKKR06-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-07','-AKKR07-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-08','-AKKR08-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-09','-AKKR09-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-10','-AKKR10-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-11','-AKKR11-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-19-12','-AKKR12-19') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-01','-AKKR01-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-02','-AKKR02-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-03','-AKKR03-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-04','-AKKR04-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-05','-AKKR05-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-06','-AKKR06-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-07','-AKKR07-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-08','-AKKR08-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-09','-AKKR09-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-10','-AKKR10-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-11','-AKKR11-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-20-12','-AKKR12-20') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-01','-AKKR01-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-02','-AKKR02-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-03','-AKKR03-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-04','-AKKR04-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-05','-AKKR05-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-06','-AKKR06-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-07','-AKKR07-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-08','-AKKR08-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-09','-AKKR09-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-10','-AKKR10-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-11','-AKKR11-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-21-12','-AKKR12-21') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-01','-AKKR01-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-02','-AKKR02-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-03','-AKKR03-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-04','-AKKR04-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-05','-AKKR05-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-06','-AKKR06-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-07','-AKKR07-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-08','-AKKR08-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-09','-AKKR09-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-10','-AKKR10-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-11','-AKKR11-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-22-12','-AKKR12-22') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-01','-AKKR01-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-02','-AKKR02-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-03','-AKKR03-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-04','-AKKR04-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-05','-AKKR05-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-06','-AKKR06-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-07','-AKKR07-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-08','-AKKR08-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-09','-AKKR09-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-10','-AKKR10-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-11','-AKKR11-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-23-12','-AKKR12-23') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-01','-AKKR01-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-02','-AKKR02-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-03','-AKKR03-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-04','-AKKR04-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-05','-AKKR05-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-06','-AKKR06-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-07','-AKKR07-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-08','-AKKR08-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-09','-AKKR09-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-10','-AKKR10-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-11','-AKKR11-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-24-12','-AKKR12-24') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-01','-AKKR01-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-02','-AKKR02-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-03','-AKKR03-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-04','-AKKR04-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-05','-AKKR05-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-06','-AKKR06-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-07','-AKKR07-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-08','-AKKR08-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-09','-AKKR09-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-10','-AKKR10-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-11','-AKKR11-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-25-12','-AKKR12-25') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-01','-AKKR01-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-02','-AKKR02-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-03','-AKKR03-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-04','-AKKR04-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-05','-AKKR05-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-06','-AKKR06-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-07','-AKKR07-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-08','-AKKR08-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-09','-AKKR09-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-10','-AKKR10-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-11','-AKKR11-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-26-12','-AKKR12-26') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-01','-AKKR01-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-02','-AKKR02-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-03','-AKKR03-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-04','-AKKR04-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-05','-AKKR05-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-06','-AKKR06-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-07','-AKKR07-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-08','-AKKR08-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-09','-AKKR09-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-10','-AKKR10-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-11','-AKKR11-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-27-12','-AKKR12-27') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-01','-AKKR01-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-02','-AKKR02-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-03','-AKKR03-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-04','-AKKR04-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-05','-AKKR05-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-06','-AKKR06-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-07','-AKKR07-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-08','-AKKR08-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-09','-AKKR09-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-10','-AKKR10-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-11','-AKKR11-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-28-12','-AKKR12-28') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-01','-AKKR01-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-02','-AKKR02-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-03','-AKKR03-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-04','-AKKR04-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-05','-AKKR05-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-06','-AKKR06-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-07','-AKKR07-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-08','-AKKR08-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-09','-AKKR09-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-10','-AKKR10-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-11','-AKKR11-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-29-12','-AKKR12-29') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-01','-AKKR01-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-02','-AKKR02-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-03','-AKKR03-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-04','-AKKR04-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-05','-AKKR05-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-06','-AKKR06-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-07','-AKKR07-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-08','-AKKR08-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-09','-AKKR09-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-10','-AKKR10-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-11','-AKKR11-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-30-12','-AKKR12-30') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-01','-AKKR01-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-02','-AKKR02-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-03','-AKKR03-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-04','-AKKR04-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-05','-AKKR05-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-06','-AKKR06-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-07','-AKKR07-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-08','-AKKR08-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-09','-AKKR09-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-10','-AKKR10-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-11','-AKKR11-31') where serialized_value like '%_Date|%'</sql>
        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-31-12','-AKKR12-31') where serialized_value like '%_Date|%'</sql>

        <sql>update tmp_cfi_copy set serialized_value = replace(serialized_value,'-AKKR','-') where serialized_value like '%_Date|%'</sql>
 
        <sql>SET group_concat_max_len =300000</sql>
        <sql>delete from tmp_cf_values</sql>
        <sql>insert into tmp_cf_values (uuid, cf_values_txt) (
                select applies_to_uuid, cf_value_by_uuid from (select applies_to_uuid, concat('{',GROUP_CONCAT(concat('"',code,'":[', cf_value_by_code ,']')),'}') as cf_value_by_uuid
            from (
                select applies_to_uuid, code, GROUP_CONCAT(concat(cf_opening, cf_content,'}')) as cf_value_by_code from (
                select applies_to_uuid, code, concat('{"priority":',priority, 
                  case when period_start_date is null then '' else concat(',"from":"',date_format(period_start_date,'%Y-%m-%dT%T'), TIME_FORMAT( NOW() - UTC_TIMESTAMP(), '%H:%i'), '"') end,
                  case when period_end_date is null then '' else concat(',"to":"',date_format(period_end_date,'%Y-%m-%dT%T'), TIME_FORMAT( NOW() - UTC_TIMESTAMP(), '%H:%i'), '"') end) as cf_opening, 
                case when double_value is not null then concat(',"double":',double_value) 
                 else case when date_value is not null then concat(',"date":"',date_format(date_value,'%Y-%m-%dT%T'), TIME_FORMAT( NOW() - UTC_TIMESTAMP(), '%H:%i'), '"')          
                 else case when long_value is not null then concat(',"long":', long_value) 
                 else case when string_value is not null then concat(',"string":"',string_value,'"')
                 else case when left(serialized_value,6) != 'matrix' then replace(replace(replace(replace(replace(replace(
            replace(replace(replace(replace(replace(serialized_value,'list_String|',',"listString":'),'list_Double|',',"listDouble":'),'list_Long|',',"listLong":'),'list_Date|',',"listDate":'),'list_EntityReferenceWrapper|',',"listEntity":')
            ,'map_String|',',"mapString":'),'map_Double|',',"mapDouble":'),'map_Long|',',"mapLong":'),'map_Date|',',"mapDate":'),'map_EntityReferenceWrapper|',',"mapEntity":'),'entity|',',"entity":') 
                else concat(case left(serialized_value,INSTR(serialized_value, '|')-1) when 'matrix_String' then ',"mapString":' when 'matrix_Long' then ',"mapLong":' when 'matrix_Double' then ',"mapDouble":' when 'matrix_Date' then
            ',"mapDate":' when 'matrix_EntityReferenceWrapper' then ',"mapEntity":' end, substr(substr(serialized_value, INSTR(serialized_value, '|')+1), INSTR(substr(serialized_value, INSTR(serialized_value,
            '|')+1), '|')+1)) end end end end end as cf_content from tmp_cfi_copy) cf_data group by applies_to_uuid, code) cf_values_by_code group by cf_values_by_code.applies_to_uuid) cf_values_by_uuid
            )
            </sql>
            
		<!-- NOTE: here need to change appropriate timezone for the server. This is for argentina -->
        <sql>update tmp_cf_values set cf_values_txt = replace(cf_values_txt,' 00:00:00 ART','T00:00:00-03:00')</sql>

        <sql>update crm_seller set cf_values = null</sql>
        <sql>update crm_seller join tmp_cf_values on crm_seller.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt </sql>
        <sql>update crm_provider set cf_values = null</sql>
        <sql>update crm_provider join tmp_cf_values on crm_provider.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update account_entity set cf_values = null</sql>
        <sql>update account_entity join tmp_cf_values on account_entity.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update adm_user set cf_values = null</sql>
        <sql>update adm_user join tmp_cf_values on adm_user.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update ar_account_operation set cf_values = null</sql>
        <sql>update ar_account_operation join tmp_cf_values on ar_account_operation.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_cycle set cf_values = null</sql>
        <sql>update billing_cycle join tmp_cf_values on billing_cycle.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_invoice set cf_values = null</sql>
        <sql>update billing_invoice join tmp_cf_values on billing_invoice.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_invoice_cat set cf_values = null</sql>
        <sql>update billing_invoice_cat join tmp_cf_values on billing_invoice_cat.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_invoice_sub_cat set cf_values = null</sql>
        <sql>update billing_invoice_sub_cat join tmp_cf_values on billing_invoice_sub_cat.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_service_instance set cf_values = null</sql>
        <sql>update billing_service_instance join tmp_cf_values on billing_service_instance.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_subscription set cf_values = null</sql>
        <sql>update billing_subscription join tmp_cf_values on billing_subscription.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_tax set cf_values = null</sql>
        <sql>update billing_tax join tmp_cf_values on billing_tax.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update cat_charge_template set cf_values = null</sql>
        <sql>update cat_charge_template join tmp_cf_values on cat_charge_template.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update cat_offer_template set cf_values = null</sql>
        <sql>update cat_offer_template join tmp_cf_values on cat_offer_template.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update cat_price_plan_matrix set cf_values = null</sql>
        <sql>update cat_price_plan_matrix join tmp_cf_values on cat_price_plan_matrix.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update cat_service_template set cf_values = null</sql>
        <sql>update cat_service_template join tmp_cf_values on cat_service_template.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update medina_access set cf_values = null</sql>
        <sql>update medina_access join tmp_cf_values on medina_access.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update meveo_job_instance set cf_values = null</sql>
        <sql>update meveo_job_instance join tmp_cf_values on meveo_job_instance.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update meveo_filter set cf_values = null</sql>
        <sql>update meveo_filter join tmp_cf_values on meveo_filter.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update cust_cei set cf_values = null</sql>
        <sql>update cust_cei join tmp_cf_values on cust_cei.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update cat_offer_template_category set cf_values = null</sql>
        <sql>update cat_offer_template_category join tmp_cf_values on cat_offer_template_category.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update billing_product_instance set cf_values = null</sql>
        <sql>update billing_product_instance join tmp_cf_values on billing_product_instance.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update ord_order set cf_values = null</sql>
        <sql>update ord_order join tmp_cf_values on ord_order.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
        <sql>update ord_quote set cf_values = null</sql>
        <sql>update ord_quote join tmp_cf_values on ord_quote.uuid = tmp_cf_values.uuid set cf_values = cf_values_txt</sql>
    </changeSet>

    <changeSet id="#2751_migration_end" author="AndriusKarpavicius">
        <dropTable tableName="tmp_cfi_copy" />
        <dropTable tableName="tmp_cf_values" />
        <!--     <dropTable tableName="crm_custom_field_inst"/> // NOTE: Drop table after you are sure that CF values were migrated correctly -->
    </changeSet>

    <changeSet id="#2757_20170829" author="AndriusKarpavicius">
        <addColumn tableName="ord_order">
            <column name="quote_id" type="bigint"/>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="quote_id" baseTableName="ord_order" constraintName="fk_order_quote" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ord_quote" />
    </changeSet>
    <!-- https://mariadb.com/kb/en/the-mariadb-library/drop-index/ -->
	<changeSet id="performance_20170830" author="TienLanPHUNG" dbms="postgresql">
	    <sql>DROP INDEX IF EXISTS invoice_billing_run_index</sql>
		<sql>CREATE INDEX invoice_billing_run_index ON billing_invoice_agregate(billing_run_id)</sql>
		<sql>DROP INDEX IF EXISTS transaction_billing_account_index</sql>
		<sql>CREATE INDEX transaction_billing_account_index ON billing_rated_transaction(billing_account__id)</sql>
		<sql>DROP INDEX IF EXISTS transaction_billing_index</sql>
		<sql>CREATE INDEX transaction_billing_index ON billing_rated_transaction(invoice_id,wallet_id, invoice_sub_category_id)</sql>
		<sql>DROP INDEX IF EXISTS invoice_agre_index</sql>
		<sql>CREATE INDEX invoice_agre_index ON billing_invoice_agregate(invoice_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_recurring_charge_inst_index</sql>
		<sql>CREATE INDEX billing_recurring_charge_inst_index ON billing_recurring_charge_inst(service_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_chrginst_wallet_index</sql>
		<sql>CREATE INDEX billing_chrginst_wallet_index ON billing_chrginst_wallet(wallet_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_index</sql>
		<sql>CREATE INDEX billing_wallet_index ON billing_wallet(user_account_id)</sql>
		<sql>DROP INDEX IF EXISTS ar_customer_account_index</sql>
		<sql>CREATE INDEX ar_customer_account_index ON ar_customer_account(credit_category_id)</sql>
		<sql>DROP INDEX IF EXISTS meveo_module_index</sql>
		<sql>CREATE INDEX meveo_module_index ON meveo_module(script_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS account_entity_index</sql>
		<sql>CREATE INDEX account_entity_index ON account_entity(primary_contact, title_id, bam_id)</sql>
		<sql>DROP INDEX IF EXISTS meveo_module_item_index</sql>
		<sql>CREATE INDEX meveo_module_item_index ON meveo_module_item(module_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_charge_instance_index</sql>
		<sql>CREATE INDEX billing_charge_instance_index ON billing_charge_instance (invoicing_calendar_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_service_instance_index</sql>
		<sql>CREATE INDEX billing_service_instance_index ON billing_service_instance(subscription_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_user_account_index</sql>
		<sql>CREATE INDEX billing_user_account_index ON billing_user_account(billing_account_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_billing_account_index</sql>
		<sql>CREATE INDEX billing_billing_account_index ON billing_billing_account(customer_account_id)</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_index </sql>
		<sql>CREATE INDEX crm_customer_index ON crm_customer(customer_brand_id)</sql>
		<sql>DROP INDEX IF EXISTS ar_payment_customer_index</sql>
		<sql>CREATE INDEX ar_payment_customer_index ON ar_payment_token(customer_account_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_subscription_index</sql>
		<sql>CREATE INDEX billing_subscription_index ON billing_subscription(user_account_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_index</sql>
		<sql>CREATE INDEX cat_chrg_edr_index ON cat_chrg_edr(charge_tmpl_id,trigg_edr_id)</sql>
		<sql>DROP INDEX IF EXISTS adm_messages_index</sql>
		<sql>CREATE INDEX adm_messages_index ON adm_messages ((lower(entity_code)) , (lower(language_code)) )</sql>
		<sql>DROP INDEX IF EXISTS adm_title_index</sql>
		<sql>CREATE INDEX adm_title_index ON adm_title((lower(code)))</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_brand_index</sql>
		<sql>CREATE INDEX crm_customer_brand_index ON crm_customer_brand((lower(code)))</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_category_index</sql>
		<sql>CREATE INDEX crm_customer_category_index ON crm_customer_category((lower(code)))</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_trm_charge_template_index</sql>
		<sql>CREATE INDEX cat_serv_trm_charge_template_index ON cat_serv_trm_charge_template(service_template_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_usage_charge_template_index</sql>
		<sql>CREATE INDEX cat_serv_usage_charge_template_index ON cat_serv_usage_charge_template(service_template_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_usage_wallet_template_index</sql>
		<sql>CREATE INDEX cat_serv_usage_wallet_template_index ON cat_serv_usage_wallet_template(service_usage_templt_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_calendar_days_index</sql>
		<sql>CREATE INDEX cat_calendar_days_index ON cat_calendar_days(calendar_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_triggered_edr_index</sql>
		<sql>CREATE INDEX cat_triggered_edr_index ON cat_triggered_edr(meveo_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_index</sql>
		<sql>CREATE INDEX cat_chrg_edr_index ON cat_chrg_edr(charge_tmpl_id,trigg_edr_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_charge_instance_index</sql>
		<sql>CREATE INDEX billing_charge_instance_index ON billing_charge_instance (invoicing_calendar_id, lower(code))</sql>
		<sql>DROP INDEX IF EXISTS billing_invoice_index</sql>
		<sql>CREATE INDEX billing_invoice_index ON billing_invoice(invoice_id, invoice_type_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_operation_index</sql>
		<sql>CREATE INDEX billing_wallet_operation_index ON billing_wallet_operation(wallet_id, charge_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_operation_status_index</sql>
		<sql>CREATE INDEX billing_wallet_operation_status_index ON billing_wallet_operation(invoicing_date,status)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_index</sql>
		<sql>CREATE INDEX billing_wallet_index ON billing_wallet(user_account_id,cat_wallet_template_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_charge_instance_index</sql>
		<sql>CREATE INDEX billing_charge_instance_index ON billing_charge_instance(invoicing_calendar_id, lower(code), charge_template_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_reservation_index</sql>
		<sql>CREATE INDEX billing_reservation_index ON billing_reservation(subscription_id, user_account_id,wallet_id)</sql>
		<sql>DROP INDEX IF EXISTS rated_transaction_number</sql>
		<sql>CREATE INDEX rated_transaction_number ON billing_rated_transaction(order_number)</sql>
	</changeSet>

	<changeSet id="performance_20171006" author="TienLanPHUNG" dbms="mysql">
	    <sql>DROP INDEX IF EXISTS invoice_billing_run_index ON billing_invoice_agregate</sql>
		<sql>CREATE INDEX invoice_billing_run_index ON billing_invoice_agregate(billing_run_id)</sql>
		<sql>DROP INDEX IF EXISTS transaction_billing_account_index ON billing_rated_transaction</sql>
		<sql>CREATE INDEX transaction_billing_account_index ON billing_rated_transaction(billing_account__id)</sql>
		<sql>DROP INDEX IF EXISTS transaction_billing_index ON billing_rated_transaction</sql>
		<sql>CREATE INDEX transaction_billing_index ON billing_rated_transaction(invoice_id,wallet_id, invoice_sub_category_id)</sql>
		<sql>DROP INDEX IF EXISTS invoice_agre_index ON billing_invoice_agregate</sql>
		<sql>CREATE INDEX invoice_agre_index ON billing_invoice_agregate(invoice_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_recurring_charge_inst_index  ON billing_recurring_charge_inst</sql>
		<sql>CREATE INDEX billing_recurring_charge_inst_index ON billing_recurring_charge_inst(service_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_chrginst_wallet_index ON billing_chrginst_wallet</sql>
		<sql>CREATE INDEX billing_chrginst_wallet_index ON billing_chrginst_wallet(wallet_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS ar_customer_account_index ON ar_customer_account</sql>
		<sql>CREATE INDEX ar_customer_account_index ON ar_customer_account(credit_category_id)</sql>
		<sql>DROP INDEX IF EXISTS meveo_module_index ON meveo_module</sql>
		<sql>CREATE INDEX meveo_module_index ON meveo_module(script_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS account_entity_index ON account_entity</sql>
		<sql>CREATE INDEX account_entity_index ON account_entity(primary_contact, title_id, bam_id)</sql>
		<sql>DROP INDEX IF EXISTS meveo_module_item_index ON meveo_module_item</sql>
		<sql>CREATE INDEX meveo_module_item_index ON meveo_module_item(module_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_service_instance_index ON billing_service_instance</sql>
		<sql>CREATE INDEX billing_service_instance_index ON billing_service_instance(subscription_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_user_account_index ON billing_user_account</sql>
		<sql>CREATE INDEX billing_user_account_index ON billing_user_account(billing_account_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_billing_account_index ON billing_billing_account</sql>
		<sql>CREATE INDEX billing_billing_account_index ON billing_billing_account(customer_account_id)</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_index ON crm_customer</sql>
		<sql>CREATE INDEX crm_customer_index ON crm_customer(customer_brand_id)</sql>
		<sql>DROP INDEX IF EXISTS ar_payment_customer_index ON ar_payment_token</sql>
		<sql>CREATE INDEX ar_payment_customer_index ON ar_payment_token(customer_account_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_subscription_index ON billing_subscription</sql>
		<sql>CREATE INDEX billing_subscription_index ON billing_subscription(user_account_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_index ON cat_chrg_edr</sql>
		<sql>CREATE INDEX cat_chrg_edr_index ON cat_chrg_edr(charge_tmpl_id,trigg_edr_id)</sql>
		<sql>DROP INDEX IF EXISTS adm_messages_index ON adm_messages</sql>
		<sql>CREATE INDEX adm_messages_index ON adm_messages (entity_code,language_code)</sql>
		<sql>DROP INDEX IF EXISTS adm_title_index ON adm_title</sql>
		<sql>CREATE INDEX adm_title_index ON adm_title(code)</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_brand_index ON crm_customer_brand</sql>
		<sql>CREATE INDEX crm_customer_brand_index ON crm_customer_brand(code)</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_category_index ON crm_customer_category</sql>
		<sql>CREATE INDEX crm_customer_category_index ON crm_customer_category(code)</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_trm_charge_template_index ON cat_serv_trm_charge_template</sql>
		<sql>CREATE INDEX cat_serv_trm_charge_template_index ON cat_serv_trm_charge_template(service_template_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_usage_charge_template_index ON cat_serv_usage_charge_template</sql>
		<sql>CREATE INDEX cat_serv_usage_charge_template_index ON cat_serv_usage_charge_template(service_template_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_usage_wallet_template_index ON cat_serv_usage_wallet_template</sql>
		<sql>CREATE INDEX cat_serv_usage_wallet_template_index ON cat_serv_usage_wallet_template(service_usage_templt_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_calendar_days_index ON cat_calendar_days</sql>
		<sql>CREATE INDEX cat_calendar_days_index ON cat_calendar_days(calendar_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_triggered_edr_index ON cat_triggered_edr</sql>
		<sql>CREATE INDEX cat_triggered_edr_index ON cat_triggered_edr(meveo_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_index ON cat_chrg_edr</sql>
		<sql>CREATE INDEX cat_chrg_edr_index ON cat_chrg_edr(charge_tmpl_id,trigg_edr_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_invoice_index ON billing_invoice</sql>
		<sql>CREATE INDEX billing_invoice_index ON billing_invoice(invoice_id, invoice_type_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_operation_index ON billing_wallet_operation</sql>
		<sql>CREATE INDEX billing_wallet_operation_index ON billing_wallet_operation(wallet_id, charge_instance_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_operation_status_index ON billing_wallet_operation</sql>
		<sql>CREATE INDEX billing_wallet_operation_status_index ON billing_wallet_operation(invoicing_date,status)</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_index ON billing_wallet</sql>
		<sql>CREATE INDEX billing_wallet_index ON billing_wallet(user_account_id,cat_wallet_template_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_charge_instance_index ON billing_charge_instance</sql>
		<sql>CREATE INDEX billing_charge_instance_index ON billing_charge_instance(invoicing_calendar_id, code, charge_template_id)</sql>
		<sql>DROP INDEX IF EXISTS billing_reservation_index ON billing_reservation</sql>
		<sql>CREATE INDEX billing_reservation_index ON billing_reservation(subscription_id, user_account_id,wallet_id)</sql>
		<sql>DROP INDEX IF EXISTS rated_transaction_number_index ON billing_rated_transaction</sql>
		<sql>CREATE INDEX rated_transaction_number_index ON billing_rated_transaction(order_number)</sql>
	</changeSet>
    
    <changeSet id="#2761_20170831" author="AndriusKarpavicius">    
        <addColumn tableName="cat_offer_template">
            <column name="auto_renew" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="days_notify_renew" type="INT4" />
            <column name="end_of_term_action" type="varchar(10)" />
            <column name="auto_termin_reason_id" type="bigint" />
            <column name="init_active_unit" type="varchar(5)" />
            <column name="init_active" type="INT4" />
            <column name="match_end_aggr_date" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="renew_for_unit" type="varchar(5)" />
            <column name="renew_for" type="INT4" />   
        </addColumn>
    </changeSet>
    
    <changeSet id="#2586_20170906 Add filter expression to one-shot charge template" author="EdwardLegaspi">
    	<addColumn tableName="cat_one_shot_charge_templ">
    		<column name="filter_expression" type="varchar(2000)" />
    	</addColumn>
    </changeSet>
    
     
    <changeSet id="#2780_20170821" author="AndriusKarpavicius">
        <addColumn tableName="adm_title">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="billing_invoice_cat">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="billing_invoice_sub_cat">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="billing_tax">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="cat_price_plan_matrix">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="cat_charge_template">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="cat_offer_template">
            <column name="description_i18n" type="${type.json}" />
            <column name="long_description_i18n" type="${type.json}" />
        </addColumn>

        <createTable tableName="tmp_desc_values">
            <column name="clazz" type="varchar(255)" />
            <column name="code" type="varchar(255)" />
            <column name="desc_values_txt" type="text" />
        </createTable>

    </changeSet>

    <changeSet id="#2780_desc_migration_P1" author="AndriusKarpavicius" dbms="postgresql">

        <sql>delete from tmp_desc_values</sql>
        <sql>insert into tmp_desc_values (clazz, code, desc_values_txt) (select entity_class, entity_code, '{'|| string_agg('"'||language_code ||'":"'|| description||'"',',') || '}' as desc_value from adm_messages group by entity_class, entity_code order by entity_class)</sql>

        <sql>update adm_title set description_i18n = null</sql>
        <sql>update adm_title set description_i18n = desc_values_txt from tmp_desc_values where adm_title.code = tmp_desc_values.code and tmp_desc_values.clazz='Title'</sql>
        <sql>update billing_invoice_cat set description_i18n = null</sql>
        <sql>update billing_invoice_cat set description_i18n = desc_values_txt from tmp_desc_values where billing_invoice_cat.code = tmp_desc_values.code and tmp_desc_values.clazz='InvoiceCategory'</sql>
        <sql>update billing_invoice_sub_cat set description_i18n = null</sql>
        <sql>update billing_invoice_sub_cat set description_i18n = desc_values_txt from tmp_desc_values where billing_invoice_sub_cat.code = tmp_desc_values.code and tmp_desc_values.clazz='InvoiceSubCategory'</sql>
        <sql>update billing_tax set description_i18n = null</sql>
        <sql>update billing_tax set description_i18n = desc_values_txt from tmp_desc_values where billing_tax.code = tmp_desc_values.code and tmp_desc_values.clazz='Tax'</sql>
        <sql>update cat_price_plan_matrix set description_i18n = null</sql>
        <sql>update cat_price_plan_matrix set description_i18n = desc_values_txt from tmp_desc_values where cat_price_plan_matrix.code = tmp_desc_values.code and tmp_desc_values.clazz='PricePlanMatrix'</sql>
        <sql>update cat_charge_template set description_i18n = null</sql>
        <sql>update cat_charge_template set description_i18n = desc_values_txt from tmp_desc_values where cat_charge_template.code = tmp_desc_values.code and tmp_desc_values.clazz in ('OneShotChargeTemplate','ProductChargeTemplate','RecurringChargeTemplate','UsageChargeTemplate','ChargeTemplate')</sql>
        <sql>update cat_offer_template set description_i18n = null</sql>
        <sql>update cat_offer_template set description_i18n = desc_values_txt from tmp_desc_values where cat_offer_template.code = tmp_desc_values.code and tmp_desc_values.clazz in ('OfferTemplate','ProductTemplate','BundleTemplate','ProductOffering')</sql>
    </changeSet>
    
    
    <changeSet id="#2780_desc_migration_M1" author="AndriusKarpavicius" dbms="mysql">

        <sql>SET group_concat_max_len =300000</sql>

        <sql>delete from tmp_desc_values</sql>
        <sql>insert into tmp_desc_values (clazz, code, desc_values_txt) (select entity_class, entity_code, concat('{', GROUP_CONCAT(concat('"',language_code,'":"',description,'"')),'}') as desc_value from adm_messages group by entity_class, entity_code order by entity_class)</sql>
   
        <sql>update adm_title set description_i18n = null</sql>
        <sql>update adm_title join tmp_desc_values on adm_title.code = tmp_desc_values.code set description_i18n = desc_values_txt where  tmp_desc_values.clazz='Title'</sql>
        <sql>update billing_invoice_cat set description_i18n = null</sql>
        <sql>update billing_invoice_cat join tmp_desc_values on billing_invoice_cat.code = tmp_desc_values.code set description_i18n = desc_values_txt where tmp_desc_values.clazz='InvoiceCategory'</sql>
        <sql>update billing_invoice_sub_cat set description_i18n = null</sql>
        <sql>update billing_invoice_sub_cat join tmp_desc_values on billing_invoice_sub_cat.code = tmp_desc_values.code set description_i18n = desc_values_txt where tmp_desc_values.clazz='InvoiceSubCategory'</sql>
        <sql>update billing_tax set description_i18n = null</sql>
        <sql>update billing_tax join tmp_desc_values on billing_tax.code = tmp_desc_values.code set description_i18n = desc_values_txt where tmp_desc_values.clazz='Tax'</sql>
        <sql>update cat_price_plan_matrix set description_i18n = null</sql>
        <sql>update cat_price_plan_matrix join tmp_desc_values on cat_price_plan_matrix.code = tmp_desc_values.code set description_i18n = desc_values_txt where tmp_desc_values.clazz='PricePlanMatrix'</sql>
        <sql>update cat_charge_template set description_i18n = null</sql>
        <sql>update cat_charge_template join tmp_desc_values on cat_charge_template.code = tmp_desc_values.code set description_i18n = desc_values_txt where tmp_desc_values.clazz in ('OneShotChargeTemplate','ProductChargeTemplate','RecurringChargeTemplate','UsageChargeTemplate','ChargeTemplate')</sql>
        <sql>update cat_offer_template set description_i18n = null</sql>
        <sql>update cat_offer_template join tmp_desc_values on cat_offer_template.code = tmp_desc_values.code set description_i18n = desc_values_txt where tmp_desc_values.clazz in ('OfferTemplate','ProductTemplate','BundleTemplate','ProductOffering')</sql>
      
    </changeSet>
    
    <changeSet id="#2780_desc_migration_end" author="AndriusKarpavicius">
        <dropTable tableName="tmp_desc_values" />
        <!--     <dropTable tableName="adm_messages"/> // NOTE: Drop table after you are sure that description translation values were migrated correctly -->
    </changeSet>
    
    <changeSet id="#2845_20170914" author="anasseh">       
        <addColumn tableName="billing_service_instance">
            <column name="rate_until_date" type="datetime" />           
        </addColumn>
        <sql>update billing_service_instance set rate_until_date = status_date</sql>
    </changeSet>

    <changeSet id="#2759_20170907" author="anasseh">    
        <addColumn tableName="ar_customer_account">
            <column name="excluded_from_payment" type="${type.boolean}" defaultValueNumeric="0" />           
        </addColumn>
        <addColumn tableName="ar_payment_token">
            <column name="creator" type="varchar(100)" />
        </addColumn>  
        <addColumn tableName="ar_payment_token">    
            <column name="updater" type="varchar(100)" />   
        </addColumn>    
        <addColumn tableName="ar_payment_token">    
            <column name="created" type="datetime" defaultValueDate="2015-09-18 00:04:00.631">
                <constraints nullable="false" />
            </column>   
        </addColumn>  
        <addColumn tableName="ar_payment_token">    
           <column name="updated" type="datetime" />   
        </addColumn>  
        <addColumn tableName="ar_payment_token">
             <column name="disabled" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>           
        </addColumn>  
        <sql>update ar_payment_token set disabled = 0 , creator = 'oprncell.admin', created = '2017-09-07 14:17:44.000'  </sql>              
    </changeSet>

    <changeSet id="#2857_02102017_2" author="anasseh" dbms="mysql">
        <createTable tableName="ar_payment_gateway_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="payment_gateway_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ar_payment_gateway_seq values(1)</sql>
     </changeSet>
               
    <changeSet author="anasseh" id="#2857_02102017">
        <createSequence sequenceName="ar_payment_gateway_seq" />
        <createTable tableName="ar_payment_gateway">
            <column name="id" type="bigint" autoIncrement="${id.auto}">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ar_payment_gateway_pkey" />
            </column>
            <column name="version" type="int4" />
            <column name="disabled" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="code" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(255)" />
            <column name="type" type="varchar(255)" >
            		<constraints nullable="false" />
            </column>
            <column name="payment_method" type="varchar(255)" />
            <column name="card_type" type="varchar(255)" />
            <column name="implementation_class_name" type="varchar(255)" />
            <column name="script_instance_id" type="bigint" />
            <column name="trading_country_id" type="bigint" />
            <column name="trading_currency_id" type="bigint" />
            <column name="application_el" type="varchar(2000)">
                <constraints nullable="true" />
            </column>            
            <column name="uuid" type="varchar(60)">
                <constraints nullable="false" />
            </column>
             <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="cf_values" type="${type.json}" />
        </createTable>
        
        <createTable tableName="crm_provider_pay_methods">
	         <column name="provider_id" type="bigint" />
	         <column name="payment_method" type="varchar(255)" />
        </createTable>
        
         <dropColumn tableName="crm_provider" columnName="payment_methods" />
         
         <addUniqueConstraint  columnNames="provider_id, payment_method" constraintName="uk_prov_pay_meth" tableName="crm_provider_pay_methods"/> 
        
        <addForeignKeyConstraint baseColumnNames="script_instance_id" baseTableName="ar_payment_gateway" constraintName="fk_paygw_script_instance" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meveo_script_instance" />
            
        <addForeignKeyConstraint baseColumnNames="trading_country_id" baseTableName="ar_payment_gateway" constraintName="fk_paygw_trad_country" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_trading_country" />
            
        <addForeignKeyConstraint baseColumnNames="trading_currency_id" baseTableName="ar_payment_gateway" constraintName="fk_paygw_trad_currency" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_trading_currency" />  
        
    </changeSet>
        
    
    <changeSet id="#2879_20171002" author="AndriusKarpavicius"> 
        <modifyDataType tableName="account_entity" columnName="address_1" newDataType="varchar(255)"/>   
        <modifyDataType tableName="account_entity" columnName="address_2" newDataType="varchar(255)"/>    
        <modifyDataType tableName="account_entity" columnName="address_3" newDataType="varchar(255)"/>          
        <modifyDataType tableName="com_sender_config" columnName="address_1" newDataType="varchar(255)"/>   
        <modifyDataType tableName="com_sender_config" columnName="address_2" newDataType="varchar(255)"/>    
        <modifyDataType tableName="com_sender_config" columnName="address_3" newDataType="varchar(255)"/>           
        <modifyDataType tableName="crm_provider" columnName="address_1" newDataType="varchar(255)"/>   
        <modifyDataType tableName="crm_provider" columnName="address_2" newDataType="varchar(255)"/>    
        <modifyDataType tableName="crm_provider" columnName="address_3" newDataType="varchar(255)"/>          
        <modifyDataType tableName="crm_provider_contact" columnName="address_1" newDataType="varchar(255)"/>   
        <modifyDataType tableName="crm_provider_contact" columnName="address_2" newDataType="varchar(255)"/>    
        <modifyDataType tableName="crm_provider_contact" columnName="address_3" newDataType="varchar(255)"/>          
        <modifyDataType tableName="crm_seller" columnName="address_1" newDataType="varchar(255)"/>   
        <modifyDataType tableName="crm_seller" columnName="address_2" newDataType="varchar(255)"/>    
        <modifyDataType tableName="crm_seller" columnName="address_3" newDataType="varchar(255)"/>          
        <modifyDataType tableName="ord_order_item" columnName="address_1" newDataType="varchar(255)"/>   
        <modifyDataType tableName="ord_order_item" columnName="address_2" newDataType="varchar(255)"/>    
        <modifyDataType tableName="ord_order_item" columnName="address_3" newDataType="varchar(255)"/>  
    </changeSet>
      
    <changeSet id="#2824_20170928" author="AndriusKarpavicius">    
        <addColumn tableName="billing_invoice">
            <column name="pdf_filename" type="varchar(255)"  />           
        </addColumn>
        <addColumn tableName="billing_invoice_type">
            <column name="pdf_filename_el" type="varchar(2000)"  />           
        </addColumn>        
    </changeSet>
    
    <changeSet id="#2824_20170928_migration_P" author="AndriusKarpavicius" dbms="postgresql">    
        <sql>update billing_invoice set pdf_filename=to_char(invoice_date,'YYYY.MM.DD')|| (case when billing_invoice_type.code='ADJ' then '_IA_' else  '_' end) ||case when invoice_number is not null then invoice_number else temporary_invoice_number end|| '.pdf' from billing_invoice_type where billing_invoice.invoice_type_id = billing_invoice_type.id and pdf_generated=1</sql> 
    </changeSet>    
    
    <changeSet id="#2824_20170928_migration_M" author="AndriusKarpavicius" dbms="mysql">    
        <sql>update billing_invoice join billing_invoice_type on billing_invoice.invoice_type_id = billing_invoice_type.id set pdf_filename=concat(date_format(invoice_date,'%Y.%m.%d'), (case when billing_invoice_type.code='ADJ' then '_IA_' else  '_' end), case when invoice_number is not null then invoice_number else temporary_invoice_number end, '.pdf') where pdf_generated=1</sql> 
    </changeSet>
           
    <changeSet id="#2824_20170928_1" author="AndriusKarpavicius">     
        <dropColumn tableName="billing_invoice" columnName="pdf_generated"/>
    </changeSet> 
       
    
    <changeSet id="#2824_20170929" author="AndriusKarpavicius">    
        <addColumn tableName="billing_invoice">
            <column name="xml_filename" type="varchar(255)"  />           
        </addColumn>
        <addColumn tableName="billing_invoice_type">
            <column name="xml_filename_el" type="varchar(2000)"  />           
        </addColumn>        
    </changeSet>
    
    <changeSet id="#2824_20170929_migration_P" author="AndriusKarpavicius" dbms="postgresql">    
        <sql>update billing_invoice set xml_filename=(case when billing_run_id IS NOT NULL then billing_run_id::text else to_char(billing_invoice.invoice_date,'DDMMYYYY_HH24MISS') end) || '/' || (case when billing_invoice_type.code='ADJ' then '_IA_' else  '' end) ||case when invoice_number is not null then invoice_number else temporary_invoice_number end|| '.pdf' from billing_invoice_type, billing_billing_run where billing_invoice.invoice_type_id = billing_invoice_type.id and billing_invoice.billing_run_id = billing_billing_run.id and xml_invoice_generated=1</sql> 
    </changeSet>    
    
    <changeSet id="#2824_20170929_migration_M" author="AndriusKarpavicius" dbms="mysql">    
        <sql>update billing_invoice join billing_invoice_type on billing_invoice.invoice_type_id = billing_invoice_type.id join billing_billing_run on billing_invoice.billing_run_id = billing_billing_run.id set xml_filename=concat((case when billing_run_id IS NOT NULL then billing_run_id else date_format(billing_invoice.invoice_date,'%d%m%Y_%k%%S') end) , '/' , (case when billing_invoice_type.code='ADJ' then '_IA_' else  '' end), case when invoice_number is not null then invoice_number else temporary_invoice_number end, '.pdf') where xml_invoice_generated=1</sql> 
    </changeSet>
    
    <changeSet id="#2827_20171002" author="anasseh">     
        <dropColumn tableName="billing_billing_run" columnName="xml_invoice_generated"/>
    </changeSet> 
               
    <changeSet id="Perf_Improvement_20171023" author="WassimDRIRA" dbms="postgresql">       
        <sql>DROP INDEX IF EXISTS customer_code;</sql>
		<sql>CREATE INDEX customer_code ON account_entity(lower(code));</sql>
		<sql>DROP INDEX IF EXISTS billing_one_shot_charge_inst_subs_serv_inst_id;</sql>
		<sql>CREATE INDEX billing_one_shot_charge_inst_subs_serv_inst_id ON billing_one_shot_charge_inst(subs_serv_inst_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_calendar_join_cal_1_id;</sql>
		<sql>CREATE INDEX cat_calendar_join_cal_1_id ON cat_calendar(join_cal_1_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_calendar_join_cal_2_id;</sql>
		<sql>CREATE INDEX cat_calendar_join_cal_2_id ON cat_calendar(join_cal_2_id);</sql>
		<sql>DROP INDEX IF EXISTS bc_instance_inv_cal_id;</sql>
		<sql>CREATE INDEX bc_instance_inv_cal_id ON billing_charge_instance(invoicing_calendar_id);</sql>
		<sql>DROP INDEX IF EXISTS term_serv_inst_id_index;</sql>
		<sql>CREATE INDEX term_serv_inst_id_index ON billing_one_shot_charge_inst(term_serv_inst_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_usage_charge_inst_index ;</sql>
		<sql>CREATE INDEX billing_usage_charge_inst_index ON billing_usage_charge_inst(service_instance_id);</sql>
		<sql>DROP INDEX IF EXISTS invoicing_calendar_id_index ;</sql>
		<sql>CREATE INDEX invoicing_calendar_id_index ON cat_offer_template(invoicing_calendar_id);</sql>
		<sql>DROP INDEX IF EXISTS cb_product_template_id_index ;</sql>
		<sql>CREATE INDEX cb_product_template_id_index ON cat_business_product_model(product_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_product_wallet_template_id_index ;</sql>
		<sql>CREATE INDEX cat_product_wallet_template_id_index ON cat_product_wallet_template(wallet_template_id);</sql>
		<sql>DROP INDEX IF EXISTS adm_sc_instance_id_inde;</sql>
		<sql>CREATE INDEX adm_sc_instance_id_index ON adm_script_sourc_role(script_instance_id);</sql>
		<sql>DROP INDEX IF EXISTS adm_sc_role_id_index;</sql>
		<sql>CREATE INDEX adm_sc_role_id_index ON adm_script_sourc_role(role_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_bsm_st_id_index;</sql>
		<sql>CREATE INDEX cat_bsm_st_id_index ON cat_business_serv_model(service_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_st_inv_cal_id_index ;</sql>
		<sql>CREATE INDEX cat_st_inv_cal_id_index ON cat_service_template(invoicing_calendar_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_st_serv_mod_id_index ;</sql>
		<sql>CREATE INDEX cat_st_serv_mod_id_index ON cat_service_template(business_service_model_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_rct_service_template_index ;</sql>
		<sql>CREATE INDEX cat_rct_service_template_index ON cat_serv_rec_charge_template(service_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_rwt_wallet_template_index ;</sql>
		<sql>CREATE INDEX cat_rwt_wallet_template_index ON cat_serv_rec_wallet_template(wallet_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_su_wallet_template_index ;</sql>
		<sql>CREATE INDEX cat_su_wallet_template_index ON cat_serv_usage_wallet_template(wallet_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_bp_model_index ;</sql>
		<sql>CREATE INDEX cat_ofrt_bp_model_index ON cat_offer_template(business_product_model_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_valid_to_index ;</sql>
		<sql>CREATE INDEX cat_ofrt_valid_to_index ON cat_offer_template(valid_to);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_valid_from_index ;</sql>
		<sql>CREATE INDEX cat_ofrt_valid_from_index ON cat_offer_template(valid_from);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_code_index ;</sql>
		<sql>CREATE INDEX cat_ofrt_code_index ON cat_offer_template((lower(code)));</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrpt_ofr_template_index ;</sql>
		<sql>CREATE INDEX cat_ofrpt_ofr_template_index ON cat_offer_product_template(offer_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrpt_pr_template_index ;</sql>
		<sql>CREATE INDEX cat_ofrpt_pr_template_index ON cat_offer_product_template(product_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_service_template_code_index ;</sql>
		<sql>CREATE INDEX cat_service_template_code_index ON cat_service_template(lower(code));</sql>
		<sql>DROP INDEX IF EXISTS account_entity_bam_id_index;</sql>
		<sql>CREATE INDEX account_entity_bam_id_index ON account_entity(bam_id);</sql>
		<sql>DROP INDEX IF EXISTS account_entity_title_id_index;</sql>
		<sql>CREATE INDEX account_entity_title_id_index ON account_entity(title_id);</sql>
		<sql>DROP INDEX IF EXISTS account_entity_primary_contact_index;</sql>
		<sql>CREATE INDEX account_entity_primary_contact_index ON account_entity(primary_contact);</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_primary_contact_index;</sql>
		<sql>CREATE INDEX crm_customer_primary_contact_index ON crm_customer(customer_category_id);</sql>
		<sql>DROP INDEX IF EXISTS crm_seller_bam_id_index;</sql>
		<sql>CREATE INDEX crm_seller_bam_id_index ON crm_seller(bam_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_charge_template_code_index;</sql>
		<sql>CREATE INDEX cat_charge_template_code_index ON cat_charge_template(lower(code));</sql>
		<sql>DROP INDEX IF EXISTS ord_quote_version_index;</sql>
		<sql>CREATE INDEX ord_quote_version_index ON ord_quote(version);</sql>
		<sql>DROP INDEX IF EXISTS billing_invoice_version_index;</sql>
		<sql>CREATE INDEX billing_invoice_version_index ON billing_invoice(version);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_payment_index;</sql>
		<sql>CREATE INDEX ord_order_payment_index ON ord_order(payment_method_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_quote_index;</sql>
		<sql>CREATE INDEX ord_order_quote_index ON ord_order(quote_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_item_ua_index;</sql>
		<sql>CREATE INDEX ord_order_item_ua_index ON ord_order_item(user_account_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_item_order_index;</sql>
		<sql>CREATE INDEX ord_order_item_order_index ON ord_order_item(order_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_item_sub_index;</sql>
		<sql>CREATE INDEX ord_order_item_sub_index ON ord_order_item(subscription_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_subscription_code_index;</sql>
		<sql>CREATE INDEX billing_subscription_code_index ON  billing_subscription(lower(code));</sql>
		<sql>DROP INDEX IF EXISTS cat_offer_serv_templates_svtmpte_index;</sql>
		<sql>CREATE INDEX cat_offer_serv_templates_svtmpte_index ON  cat_offer_serv_templates(service_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_service_template_bsm_index ;</sql>
		<sql>CREATE INDEX cat_service_template_bsm_index ON cat_service_template(business_service_model_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_service_instance_code_index;</sql>
		<sql>CREATE INDEX billing_service_instance_code_index ON  billing_service_instance(lower(code));</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_sub_wallet_template_srvsubtmp_index ;</sql>
		<sql>CREATE INDEX cat_serv_sub_wallet_template_srvsubtmp_index ON  cat_serv_sub_wallet_template(Service_sub_templt_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_charge_instance_code_index;</sql>
		<sql>CREATE INDEX billing_charge_instance_code_index ON  billing_charge_instance(lower(code));</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_ua_index;</sql>
		<sql>CREATE INDEX billing_wallet_ua_index ON  billing_wallet (user_account_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_user_account_id_index ;</sql>
		<sql>CREATE INDEX  billing_user_account_id_index ON  billing_user_account(id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofr_srv_tmpl_ofrtmpl_id_index ;</sql>
		<sql>CREATE INDEX  cat_ofr_srv_tmpl_ofrtmpl_id_index ON cat_offer_serv_templates(offer_template_id);</sql>
		<sql>DROP INDEX IF EXISTS bbilling_account_disc_plan_index ;</sql>
		<sql>CREATE INDEX  bbilling_account_disc_plan_index ON billing_billing_account(discount_plan_id);</sql>
		<sql>DROP INDEX IF EXISTS adm_user_title_index;</sql>
		<sql>CREATE INDEX  adm_user_title_index ON adm_user(title_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_chtmpl_index;</sql>
		<sql>CREATE INDEX  cat_chrg_edr_chtmpl_index ON cat_chrg_edr(charge_tmpl_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_trigg_edr_index;</sql>
		<sql>CREATE INDEX  cat_chrg_edr_trigg_edr_index ON cat_chrg_edr(trigg_edr_id);</sql>
    </changeSet>
    
    <changeSet id="Perf_Improvement_20171023" author="WassimDRIRA" dbms="mysql">       
        <sql>DROP INDEX IF EXISTS customer_code ON account_entity;</sql>
		<sql>CREATE INDEX customer_code ON account_entity(code);</sql>
		<sql>DROP INDEX IF EXISTS billing_one_shot_charge_inst_subs_serv_inst_id ON billing_one_shot_charge_inst;</sql>
		<sql>CREATE INDEX billing_one_shot_charge_inst_subs_serv_inst_id ON billing_one_shot_charge_inst(subs_serv_inst_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_calendar_join_cal_1_id ON cat_calendar;</sql>
		<sql>CREATE INDEX cat_calendar_join_cal_1_id ON cat_calendar(join_cal_1_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_calendar_join_cal_2_id ON cat_calendar;</sql>
		<sql>CREATE INDEX cat_calendar_join_cal_2_id ON cat_calendar(join_cal_2_id);</sql>
		<sql>DROP INDEX IF EXISTS bc_instance_inv_cal_id ON billing_charge_instance;</sql>
		<sql>CREATE INDEX bc_instance_inv_cal_id ON billing_charge_instance(invoicing_calendar_id);</sql>
		<sql>DROP INDEX IF EXISTS term_serv_inst_id_index ON billing_one_shot_charge_inst;</sql>
		<sql>CREATE INDEX term_serv_inst_id_index ON billing_one_shot_charge_inst(term_serv_inst_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_usage_charge_inst_index ON billing_usage_charge_inst;</sql>
		<sql>CREATE INDEX billing_usage_charge_inst_index ON billing_usage_charge_inst(service_instance_id);</sql>
		<sql>DROP INDEX IF EXISTS invoicing_calendar_id_index ON cat_offer_template;</sql>
		<sql>CREATE INDEX invoicing_calendar_id_index ON cat_offer_template(invoicing_calendar_id);</sql>
		<sql>DROP INDEX IF EXISTS cb_product_template_id_index ON cat_business_product_model;</sql>
		<sql>CREATE INDEX cb_product_template_id_index ON cat_business_product_model(product_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_product_wallet_template_id_index ON cat_product_wallet_template;</sql>
		<sql>CREATE INDEX cat_product_wallet_template_id_index ON cat_product_wallet_template(wallet_template_id);</sql>
		<sql>DROP INDEX IF EXISTS adm_sc_instance_id_inde ON adm_script_sourc_role;</sql>
		<sql>CREATE INDEX adm_sc_instance_id_index ON adm_script_sourc_role(script_instance_id);</sql>
		<sql>DROP INDEX IF EXISTS adm_sc_role_id_index ON adm_script_sourc_role;</sql>
		<sql>CREATE INDEX adm_sc_role_id_index ON adm_script_sourc_role(role_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_bsm_st_id_index ON cat_business_serv_model;</sql>
		<sql>CREATE INDEX cat_bsm_st_id_index ON cat_business_serv_model(service_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_st_inv_cal_id_index ON cat_service_template;</sql>
		<sql>CREATE INDEX cat_st_inv_cal_id_index ON cat_service_template(invoicing_calendar_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_st_serv_mod_id_index ON cat_service_template;</sql>
		<sql>CREATE INDEX cat_st_serv_mod_id_index ON cat_service_template(business_service_model_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_rct_service_template_index ON cat_serv_rec_charge_template;</sql>
		<sql>CREATE INDEX cat_rct_service_template_index ON cat_serv_rec_charge_template(service_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_rwt_wallet_template_index ON cat_serv_rec_wallet_template;</sql>
		<sql>CREATE INDEX cat_rwt_wallet_template_index ON cat_serv_rec_wallet_template(wallet_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_su_wallet_template_index ON cat_serv_usage_wallet_template;</sql>
		<sql>CREATE INDEX cat_su_wallet_template_index ON cat_serv_usage_wallet_template(wallet_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_bp_model_index ON cat_offer_template;</sql>
		<sql>CREATE INDEX cat_ofrt_bp_model_index ON cat_offer_template(business_product_model_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_valid_to_index ON cat_offer_template;</sql>
		<sql>CREATE INDEX cat_ofrt_valid_to_index ON cat_offer_template(valid_to);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_valid_from_index ON cat_offer_template;</sql>
		<sql>CREATE INDEX cat_ofrt_valid_from_index ON cat_offer_template(valid_from);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrt_code_index ON cat_offer_template;</sql>
		<sql>CREATE INDEX cat_ofrt_code_index ON cat_offer_template(code);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrpt_ofr_template_index ON cat_offer_product_template;</sql>
		<sql>CREATE INDEX cat_ofrpt_ofr_template_index ON cat_offer_product_template(offer_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofrpt_pr_template_index ON cat_offer_product_template;</sql>
		<sql>CREATE INDEX cat_ofrpt_pr_template_index ON cat_offer_product_template(product_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_service_template_code_index ON cat_service_template;</sql>
		<sql>CREATE INDEX cat_service_template_code_index ON cat_service_template(code);</sql>
		<sql>DROP INDEX IF EXISTS account_entity_bam_id_index ON account_entity;</sql>
		<sql>CREATE INDEX account_entity_bam_id_index ON account_entity(bam_id);</sql>
		<sql>DROP INDEX IF EXISTS account_entity_title_id_index ON account_entity;</sql>
		<sql>CREATE INDEX account_entity_title_id_index ON account_entity(title_id);</sql>
		<sql>DROP INDEX IF EXISTS account_entity_primary_contact_index ON account_entity;</sql>
		<sql>CREATE INDEX account_entity_primary_contact_index ON account_entity(primary_contact);</sql>
		<sql>DROP INDEX IF EXISTS crm_customer_primary_contact_index ON crm_customer;</sql>
		<sql>CREATE INDEX crm_customer_primary_contact_index ON crm_customer(customer_category_id);</sql>
		<sql>DROP INDEX IF EXISTS crm_seller_bam_id_index ON crm_seller;</sql>
		<sql>CREATE INDEX crm_seller_bam_id_index ON crm_seller(bam_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_charge_template_code_index ON cat_charge_template;</sql>
		<sql>CREATE INDEX cat_charge_template_code_index ON cat_charge_template(code);</sql>
		<sql>DROP INDEX IF EXISTS ord_quote_version_index ON ord_quote;</sql>
		<sql>CREATE INDEX ord_quote_version_index ON ord_quote(version);</sql>
		<sql>DROP INDEX IF EXISTS billing_invoice_version_index ON billing_invoice;</sql>
		<sql>CREATE INDEX billing_invoice_version_index ON billing_invoice(version);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_payment_index ON ord_order;</sql>
		<sql>CREATE INDEX ord_order_payment_index ON ord_order(payment_method_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_quote_index ON ord_order;</sql>
		<sql>CREATE INDEX ord_order_quote_index ON ord_order(quote_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_item_ua_index ON ord_order_item;</sql>
		<sql>CREATE INDEX ord_order_item_ua_index ON ord_order_item(user_account_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_item_order_index ON ord_order_item;</sql>
		<sql>CREATE INDEX ord_order_item_order_index ON ord_order_item(order_id);</sql>
		<sql>DROP INDEX IF EXISTS ord_order_item_sub_index ON ord_order_item;</sql>
		<sql>CREATE INDEX ord_order_item_sub_index ON ord_order_item(subscription_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_subscription_code_index ON  billing_subscription;</sql>
		<sql>CREATE INDEX billing_subscription_code_index ON  billing_subscription(code);</sql>
		<sql>DROP INDEX IF EXISTS cat_offer_serv_templates_svtmpte_index ON  cat_offer_serv_templates;</sql>
		<sql>CREATE INDEX cat_offer_serv_templates_svtmpte_index ON  cat_offer_serv_templates(service_template_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_service_template_bsm_index ON cat_service_template;</sql>
		<sql>CREATE INDEX cat_service_template_bsm_index ON cat_service_template(business_service_model_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_service_instance_code_index ON  billing_service_instance;</sql>
		<sql>CREATE INDEX billing_service_instance_code_index ON  billing_service_instance(code);</sql>
		<sql>DROP INDEX IF EXISTS cat_serv_sub_wallet_template_srvsubtmp_index ON  cat_serv_sub_wallet_template;</sql>
		<sql>CREATE INDEX cat_serv_sub_wallet_template_srvsubtmp_index ON  cat_serv_sub_wallet_template(Service_sub_templt_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_charge_instance_code_index ON  billing_charge_instance;</sql>
		<sql>CREATE INDEX billing_charge_instance_code_index ON  billing_charge_instance(code);</sql>
		<sql>DROP INDEX IF EXISTS billing_wallet_ua_index ON  billing_wallet;</sql>
		<sql>CREATE INDEX billing_wallet_ua_index ON  billing_wallet (user_account_id);</sql>
		<sql>DROP INDEX IF EXISTS billing_user_account_id_index ON  billing_user_account;</sql>
		<sql>CREATE INDEX  billing_user_account_id_index ON  billing_user_account(id);</sql>
		<sql>DROP INDEX IF EXISTS cat_ofr_srv_tmpl_ofrtmpl_id_index ON cat_offer_serv_templates;</sql>
		<sql>CREATE INDEX  cat_ofr_srv_tmpl_ofrtmpl_id_index ON cat_offer_serv_templates(offer_template_id);</sql>
		<sql>DROP INDEX IF EXISTS bbilling_account_disc_plan_index ON billing_billing_account;</sql>
		<sql>CREATE INDEX  bbilling_account_disc_plan_index ON billing_billing_account(discount_plan_id);</sql>
		<sql>DROP INDEX IF EXISTS adm_user_title_index ON adm_user;</sql>
		<sql>CREATE INDEX  adm_user_title_index ON adm_user(title_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_chtmpl_index ON cat_chrg_edr;</sql>
		<sql>CREATE INDEX  cat_chrg_edr_chtmpl_index ON cat_chrg_edr(charge_tmpl_id);</sql>
		<sql>DROP INDEX IF EXISTS cat_chrg_edr_trigg_edr_index ON cat_chrg_edr;</sql>
		<sql>CREATE INDEX  cat_chrg_edr_trigg_edr_index ON cat_chrg_edr(trigg_edr_id);</sql>
    </changeSet>
    
    <changeSet id="#3017_20171031 Add phone to ba" author="EdwardPLegapi">
    	<addColumn tableName="billing_billing_account">
    		<column name="phone" type="varchar(15)" />
    	</addColumn>
    </changeSet>
    
    <changeSet id="#2837_20171016 - Add fields vat, reg no and job title" author="EdwardPLegaspi">
     	<addColumn tableName="crm_customer">
            <column name="vat_no" type="varchar(100)"  />
            <column name="registration_no" type="varchar(100)"  />           
        </addColumn>
        <addColumn tableName="account_entity">
            <column name="job_title" type="varchar(255)"  />           
        </addColumn>
    </changeSet>
    <changeSet id="#2994_20171026" author="AndriusKarpavicius">
        <addColumn tableName="billing_wallet_operation">
            <column name="parameter_extra" type="text"/>
        </addColumn>
        <addColumn tableName="billing_rated_transaction">
            <column name="parameter_extra" type="text"/>
        </addColumn>
    </changeSet>

	<changeSet
		id="#3043_20171107 - Add cascade delete on invoiceSubCategory + taxes"
		author="EdwardLegaspi">
		<dropForeignKeyConstraint baseTableName="billing_inv_sub_cat_country" constraintName="fk_95fqtc0o1qhxbvecs7rju1jhp" />
		<addForeignKeyConstraint baseColumnNames="invoice_sub_category_id"
			baseTableName="billing_inv_sub_cat_country" constraintName="fk_95fqtc0o1qhxbvecs7rju1jhp"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_invoice_sub_cat" />
	</changeSet>

    <changeSet id="#3016_20171106" author="anasseh">
	    	<addColumn tableName="cat_offer_template">
	    		<column name="script_instance_id" type="bigint" />
	    	</addColumn>
	    	<addForeignKeyConstraint baseColumnNames="script_instance_id" baseTableName="cat_offer_template" constraintName="fk_offer_script" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meveo_script_instance" />
    </changeSet>
     
    <changeSet id="#3068_20171116_Add DE and IT description to Country" author="anasseh">
        <addColumn tableName="adm_country">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
           <sql>update adm_country set description_i18n = concat( '{"FRA":"' , description_fr ,'","ENG":"' , description_en , '"}')</sql>
         <dropColumn tableName="adm_country" columnName="description_fr" /> 
         <renameColumn newColumnName="description"  oldColumnName="description_en" tableName="adm_country" columnDataType="varchar(100)"/>
     </changeSet>
     
     <changeSet id="20171121-2816 Add last login date" author="EdwardPLegaspi">
    	<addColumn tableName="adm_user">
    		<column name="last_login_date" type="datetime" />
    	</addColumn>
    </changeSet>

    <changeSet id="#2979_20171106" author="AndriusKarpavicius">
        <createTable tableName="cat_product_offer_seller">
            <column name="product_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="seller_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey columnNames="product_id, seller_id" constraintName="cat_product_offer_seller_pkey" tableName="cat_product_offer_seller" />
        
        <addForeignKeyConstraint baseColumnNames="seller_id" baseTableName="cat_product_offer_seller" constraintName="fk_pos_seller" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_seller" />
            
        <addForeignKeyConstraint baseColumnNames="product_id" baseTableName="cat_product_offer_seller" constraintName="fk_pos_product" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />            
    </changeSet>    

    <changeSet id="#2836_20171018" author="AndriusKarpavicius">
        <addColumn tableName="billing_one_shot_charge_inst">            
            <column name="quantity" type="numeric(23, 12)" />
        </addColumn>
        <addColumn tableName="billing_recurring_charge_inst">            
            <column name="quantity" type="numeric(23, 12)" />
        </addColumn>    
    </changeSet>                   

    <changeSet id="#2836_20171018_migration_P" author="AndriusKarpavicius" dbms="postgresql">    
        <sql>update billing_one_shot_charge_inst set quantity= billing_service_instance.quantity from billing_service_instance where billing_one_shot_charge_inst.subs_serv_inst_id = billing_service_instance.id and billing_one_shot_charge_inst.subs_serv_inst_id is not null</sql> 
        <sql>update billing_one_shot_charge_inst set quantity= billing_service_instance.quantity from billing_service_instance where billing_one_shot_charge_inst.term_serv_inst_id = billing_service_instance.id and billing_one_shot_charge_inst.term_serv_inst_id is not null</sql>
        <sql>update billing_one_shot_charge_inst set quantity= billing_wallet_operation.input_quantity from billing_wallet_operation where billing_wallet_operation.charge_instance_id = billing_one_shot_charge_inst.id and billing_one_shot_charge_inst.term_serv_inst_id is null and billing_one_shot_charge_inst.subs_serv_inst_id is null</sql>
        <sql>update billing_recurring_charge_inst set quantity= billing_service_instance.quantity from billing_service_instance where billing_recurring_charge_inst.service_instance_id = billing_service_instance.id</sql>
    </changeSet>    
    
    <changeSet id="#2836_20171018_migration_M" author="AndriusKarpavicius" dbms="mysql">    
        <sql>update billing_one_shot_charge_inst join billing_service_instance on billing_one_shot_charge_inst.subs_serv_inst_id = billing_service_instance.id set billing_one_shot_charge_inst.quantity= billing_service_instance.quantity where billing_one_shot_charge_inst.subs_serv_inst_id is not null</sql>
        <sql>update billing_one_shot_charge_inst join billing_service_instance on billing_one_shot_charge_inst.term_serv_inst_id = billing_service_instance.id set billing_one_shot_charge_inst.quantity= billing_service_instance.quantity where billing_one_shot_charge_inst.term_serv_inst_id is not null</sql>  
        <sql>update billing_one_shot_charge_inst join billing_wallet_operation on billing_wallet_operation.charge_instance_id = billing_one_shot_charge_inst.id set billing_one_shot_charge_inst.quantity= billing_wallet_operation.input_quantity where billing_one_shot_charge_inst.term_serv_inst_id is null and billing_one_shot_charge_inst.subs_serv_inst_id is null</sql>
        <sql>update billing_recurring_charge_inst join billing_service_instance on billing_recurring_charge_inst.service_instance_id = billing_service_instance.id set billing_recurring_charge_inst.quantity= billing_service_instance.quantity</sql>  
    </changeSet>

    <changeSet id="#2836_20171018-end" author="AndriusKarpavicius">
        <addNotNullConstraint tableName="billing_one_shot_charge_inst" columnName="quantity" columnDataType="numeric(23, 12)"/>
        <addNotNullConstraint tableName="billing_recurring_charge_inst" columnName="quantity" columnDataType="numeric(23, 12)"/>
    </changeSet>
    
<!--     <changeSet id="#2836_20171019" author="AndriusKarpavicius"> -->
<!--         <dropColumn tableName="billing_wallet_operation" columnName="input_quantity"/> -->
<!--     </changeSet> -->
    
    <changeSet id="#2836_20171019_update_P" author="AndriusKarpavicius" dbms="postgresql">
        <sql>update billing_charge_instance set seller_id=crm_customer.seller_id from billing_user_account, billing_billing_account, ar_customer_account, crm_customer where billing_charge_instance.seller_id is null and  billing_charge_instance.user_account_id=billing_user_account.id
        and billing_user_account.billing_account_id=billing_billing_account.id and billing_billing_account.customer_account_id=ar_customer_account.id and ar_customer_account.customer_id=crm_customer.id</sql>

        <sql>update billing_charge_instance set trading_country=billing_billing_account.trading_country_id from billing_user_account, billing_billing_account where billing_charge_instance.trading_country is null and billing_charge_instance.user_account_id=billing_user_account.id
        and billing_user_account.billing_account_id=billing_billing_account.id</sql>

        <sql>update billing_charge_instance set trading_currency=ar_customer_account.trading_currency_id from billing_user_account, billing_billing_account, ar_customer_account where billing_charge_instance.trading_currency is null and  billing_charge_instance.user_account_id=billing_user_account.id
        and billing_user_account.billing_account_id=billing_billing_account.id and billing_billing_account.customer_account_id=ar_customer_account.id</sql>   
    </changeSet>
    
    <changeSet id="#2836_20171019_update_M" author="AndriusKarpavicius" dbms="mysql">
        <sql>update billing_charge_instance join billing_user_account on billing_charge_instance.user_account_id=billing_user_account.id join billing_billing_account on billing_user_account.billing_account_id=billing_billing_account.id
         join ar_customer_account on billing_billing_account.customer_account_id=ar_customer_account.id join crm_customer on ar_customer_account.customer_id=crm_customer.id set billing_charge_instance.seller_id=crm_customer.seller_id where billing_charge_instance.seller_id is null</sql>

         <sql>update billing_charge_instance join billing_user_account on billing_charge_instance.user_account_id=billing_user_account.id join billing_billing_account on billing_user_account.billing_account_id=billing_billing_account.id 
         set trading_country=billing_billing_account.trading_country_id where billing_charge_instance.trading_country is null</sql>

        <sql>update billing_charge_instance join billing_user_account on billing_charge_instance.user_account_id=billing_user_account.id join billing_billing_account on billing_user_account.billing_account_id=billing_billing_account.id
        join ar_customer_account on billing_billing_account.customer_account_id=ar_customer_account.id set trading_currency=ar_customer_account.trading_currency_id where billing_charge_instance.trading_currency is null</sql>  
    </changeSet>    
    
    <changeSet id="#2836_20171019_update_end" author="AndriusKarpavicius">
        <addNotNullConstraint tableName="billing_charge_instance" columnName="user_account_id" columnDataType="bigint"/>
        <addNotNullConstraint tableName="billing_charge_instance" columnName="trading_country" columnDataType="bigint"/>
        <addNotNullConstraint tableName="billing_charge_instance" columnName="trading_currency" columnDataType="bigint"/>
        <addNotNullConstraint tableName="billing_charge_instance" columnName="seller_id" columnDataType="bigint"/>
        
        <!--  added for consistency with API and GUI -->
        <addNotNullConstraint tableName="ar_customer_account" columnName="trading_currency_id" columnDataType="bigint"/>
        <addNotNullConstraint tableName="ar_customer_account" columnName="trading_language_id" columnDataType="bigint"/>
        <addNotNullConstraint tableName="billing_billing_account" columnName="trading_country_id" columnDataType="bigint"/>
        <addNotNullConstraint tableName="billing_billing_account" columnName="trading_language_id" columnDataType="bigint"/>
        
    </changeSet>
        
    <changeSet id="#2231_20171123" author="AndriusKarpavicius">    
        <addColumn tableName="cat_price_plan_matrix">
            <column name="wo_description_el" type="varchar(2000)"  />           
        </addColumn>        
    </changeSet>
    
    <changeSet id="#2880_20171113" author="AndriusKarpavicius">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="description_i18n" type="${type.json}" />
        </addColumn>
        <addColumn tableName="crm_custom_action">
            <column name="label_i18n" type="${type.json}" />
        </addColumn>
    </changeSet>
    
    <changeSet id="#2880_20171114" author="AndriusKarpavicius">
        <modifyDataType tableName="crm_custom_field_tmpl" columnName="gui_position" newDataType="varchar(2000)"/>
        <modifyDataType tableName="crm_custom_action" columnName="gui_position" newDataType="varchar(2000)"/>
    </changeSet>
    
    <changeSet id="#3067_20171130" author="AndriusKarpavicius">
        <addColumn tableName="crm_custom_field_tmpl_mcols">
            <column name="column_use" type="int4" defaultValueNumeric="0"/>
        </addColumn>
        <sql>update crm_custom_field_tmpl_mcols set column_use=0 </sql>
        <addNotNullConstraint tableName="crm_custom_field_tmpl_mcols" columnName="column_use" columnDataType="int4" />        
    </changeSet>
    <changeSet id="#2814_20171123" author="AndriusKarpavicius">
        <addForeignKeyConstraint baseColumnNames="script_instance_id" baseTableName="cat_price_plan_matrix" constraintName="fk_pp_script" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meveo_script_instance" />

    </changeSet>
    
    <changeSet id="#3112_20171229 Add billingTemplateNameEL to invoiceType" author="EdwardPLegaspi">
    	<addColumn tableName="billing_invoice_type">
            <column name="billing_template_name_el" type="varchar(2000)"  />           
        </addColumn>   
   	</changeSet>
   	
   	 <changeSet id="#3112_20170103 Add billingTemplateNameEL to billing_cycle" author="EdwardPLegaspi">
    	<addColumn tableName="billing_cycle">
            <column name="billing_template_name_el" type="varchar(2000)"  />           
        </addColumn>   
   	</changeSet>
    
    <changeSet id="#3091_20180118" author="AndriusKarpavicius">
        <addColumn tableName="adm_inbound_request">
            <column name="resp_status" type="int4"  />           
        </addColumn>   
    </changeSet>
    
</databaseChangeLog> 